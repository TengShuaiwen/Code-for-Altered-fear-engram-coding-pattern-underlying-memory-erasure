function compute_Intercellular_association(project1,project2)
% This function recieves the special timebin of cell trace data and analysis of cellular associations in different timewindows
% associations:
%       'cosine'           - One minus the cosine of the included angle
%                            between observations (treated as vectors)
%       'seuclidean'       - Standardized Euclidean distance. Each
%                            coordinate difference between rows in X and Y
%                            is scaled by dividing by the corresponding
%                            element of the standard deviation computed
%                            from X, S=NANSTD(X). To specify another value
%                            for S, use
%                            D = PDIST2(X,Y,'seuclidean',S).
%         'pearson'        - RHO = CORR(X,Y,...) returns a P1-by-P2 matrix containing the pairwise
%                            correlation coefficient between each pair of columns in the N-by-P1 and
%                            N-by-P2 matrices X and Y.


% Inputs:
% 1. the Cell trace that respond to event A
% 2. the Cell trace that respond to event B
% precondition: Event A and  B have the same time window.

% Outputs:
% 1. plot cosine distance between the variables
% 2. plot seuclidean distance between the variables
% 3. plot pearson correlation coefficient between the variables

%2021.08.07  Xinrong Wang

if ~ismatrix(project1) || ~ismatrix(project2)
    error(message('the code is unsupported'));
end

[m1,n1]=size(project1);
[m2,n2]=size(project2);
if m1 ~= m2
    if m1>m2
        project1=project1(1:m2,1:n1)
    else
        project2=project2(1:m1,1:n2)
    end
end
% if n1 ~= n2
%     error('X and Y must have the same number of columns.');
% end
project1_trans=project1';
project2_trans=project2';
%%%%%%%%%%%%%%%% Pairwise relation between two sets of observations.
cell_cos= pdist2(project1_trans,project2_trans,'cosine');
cell_sud = pdist2(project1_trans,project2_trans,'seuclidean');
cell_cor= corr(project1,project2,'type','pearson');
%% cos distance
figure('Colormap',...
    [1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0],...
    'Color',[1 1 1],...
    'OuterPosition',[415.4 235.4 574.4 507.2]);
image(cell_cos,'CDataMapping','scaled');

ylabel({'Fear Cell ID'},'FontWeight','bold','FontName','Arial');

xlabel({'Extinction Cell ID'},'FontWeight','bold','FontName','Arial');

set(gca,'CLim',[0 1],'Colormap',...
    [0 0.250980406999588 1;0.0252100843936205 0.341736704111099 0.997198879718781;0.050420168787241 0.43249300122261 0.994397759437561;0.0756302550435066 0.523249328136444 0.991596639156342;0.100840337574482 0.614005625247955 0.988795518875122;0.126050427556038 0.704761922359467 0.985994398593903;0.151260510087013 0.795518219470978 0.983193278312683;0.176470592617989 0.886274516582489 0.980392158031464;0.225882351398468 0.867451012134552 0.869019627571106;0.275294125080109 0.84862744808197 0.757647037506104;0.324705898761749 0.829803943634033 0.646274507045746;0.374117642641068 0.810980379581451 0.534901976585388;0.423529416322708 0.792156875133514 0.423529416322708;0.455555558204651 0.78976035118103 0.400000005960464;0.487581700086594 0.787363827228546 0.376470595598221;0.519607841968536 0.784967303276062 0.352941185235977;0.551634013652802 0.782570838928223 0.329411774873734;0.583660125732422 0.780174314975739 0.30588236451149;0.615686297416687 0.777777791023254 0.282352954149246;0.647712409496307 0.77538126707077 0.258823543787003;0.679738581180573 0.772984743118286 0.235294118523598;0.711764693260193 0.770588278770447 0.211764708161354;0.743790864944458 0.768191754817963 0.18823529779911;0.775816977024078 0.765795230865479 0.164705887436867;0.807843148708344 0.763398706912994 0.141176477074623;0.839869260787964 0.76100218296051 0.117647059261799;0.871895432472229 0.758605659008026 0.0941176488995552;0.903921544551849 0.756209135055542 0.0705882385373116;0.935947716236115 0.753812670707703 0.0470588244497776;0.967973828315735 0.751416146755219 0.0235294122248888;1 0.749019622802734 0;0.996434926986694 0.737730264663696 0;0.992869853973389 0.726440906524658 0;0.989304840564728 0.71515154838562 0;0.985739767551422 0.703862190246582 0;0.982174694538116 0.692572772502899 0;0.978609621524811 0.681283414363861 0;0.975044548511505 0.669994056224823 0;0.971479475498199 0.658704698085785 0;0.967914462089539 0.647415339946747 0;0.964349389076233 0.636125981807709 0;0.960784316062927 0.624836623668671 0;0.957219243049622 0.613547265529633 0;0.953654170036316 0.602257907390594 0;0.950089156627655 0.590968549251556 0;0.946524083614349 0.579679131507874 0;0.942959010601044 0.568389773368835 0;0.939393937587738 0.557100415229797 0;0.935828864574432 0.545811057090759 0;0.932263791561127 0.534521698951721 0;0.928698778152466 0.523232340812683 0;0.92513370513916 0.511942982673645 0;0.921568632125854 0.500653624534607 0;0.918003559112549 0.489364236593246 0;0.914438486099243 0.478074878454208 0;0.910873472690582 0.46678552031517 0;0.907308399677277 0.45549613237381 0;0.903743326663971 0.444206774234772 0;0.900178253650665 0.432917416095734 0;0.89661318063736 0.421628057956696 0;0.893048107624054 0.410338699817657 0;0.889483094215393 0.399049311876297 0;0.885918021202087 0.387759953737259 0;0.882352948188782 0.376470595598221 0],...
    'FontName','Arial','FontSize',24,'FontWeight','bold','Layer','top',...
    'LineWidth',2,'XColor',[0 0 0],'XTick',[1 27],'XTickLabel',{'1','27'},...
    'YColor',[0 0 0],'YTick',[1 49],'YTickLabel',{'1','49'});
set(gca,'box','off'); 
%% seuclidean distance
figure('Colormap',...
    [1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0],...
    'Color',[1 1 1],...
    'OuterPosition',[415.4 235.4 574.4 507.2]);
image(cell_sud,'CDataMapping','scaled');

ylabel({'Fear Cell ID'},'FontWeight','bold','FontName','Arial');

xlabel({'Extinction Cell ID'},'FontWeight','bold','FontName','Arial');

set(gca,'CLim',[0 60],'Colormap',...
    [0 0.250980406999588 1;0.0252100843936205 0.341736704111099 0.997198879718781;0.050420168787241 0.43249300122261 0.994397759437561;0.0756302550435066 0.523249328136444 0.991596639156342;0.100840337574482 0.614005625247955 0.988795518875122;0.126050427556038 0.704761922359467 0.985994398593903;0.151260510087013 0.795518219470978 0.983193278312683;0.176470592617989 0.886274516582489 0.980392158031464;0.225882351398468 0.867451012134552 0.869019627571106;0.275294125080109 0.84862744808197 0.757647037506104;0.324705898761749 0.829803943634033 0.646274507045746;0.374117642641068 0.810980379581451 0.534901976585388;0.423529416322708 0.792156875133514 0.423529416322708;0.455555558204651 0.78976035118103 0.400000005960464;0.487581700086594 0.787363827228546 0.376470595598221;0.519607841968536 0.784967303276062 0.352941185235977;0.551634013652802 0.782570838928223 0.329411774873734;0.583660125732422 0.780174314975739 0.30588236451149;0.615686297416687 0.777777791023254 0.282352954149246;0.647712409496307 0.77538126707077 0.258823543787003;0.679738581180573 0.772984743118286 0.235294118523598;0.711764693260193 0.770588278770447 0.211764708161354;0.743790864944458 0.768191754817963 0.18823529779911;0.775816977024078 0.765795230865479 0.164705887436867;0.807843148708344 0.763398706912994 0.141176477074623;0.839869260787964 0.76100218296051 0.117647059261799;0.871895432472229 0.758605659008026 0.0941176488995552;0.903921544551849 0.756209135055542 0.0705882385373116;0.935947716236115 0.753812670707703 0.0470588244497776;0.967973828315735 0.751416146755219 0.0235294122248888;1 0.749019622802734 0;0.996434926986694 0.737730264663696 0;0.992869853973389 0.726440906524658 0;0.989304840564728 0.71515154838562 0;0.985739767551422 0.703862190246582 0;0.982174694538116 0.692572772502899 0;0.978609621524811 0.681283414363861 0;0.975044548511505 0.669994056224823 0;0.971479475498199 0.658704698085785 0;0.967914462089539 0.647415339946747 0;0.964349389076233 0.636125981807709 0;0.960784316062927 0.624836623668671 0;0.957219243049622 0.613547265529633 0;0.953654170036316 0.602257907390594 0;0.950089156627655 0.590968549251556 0;0.946524083614349 0.579679131507874 0;0.942959010601044 0.568389773368835 0;0.939393937587738 0.557100415229797 0;0.935828864574432 0.545811057090759 0;0.932263791561127 0.534521698951721 0;0.928698778152466 0.523232340812683 0;0.92513370513916 0.511942982673645 0;0.921568632125854 0.500653624534607 0;0.918003559112549 0.489364236593246 0;0.914438486099243 0.478074878454208 0;0.910873472690582 0.46678552031517 0;0.907308399677277 0.45549613237381 0;0.903743326663971 0.444206774234772 0;0.900178253650665 0.432917416095734 0;0.89661318063736 0.421628057956696 0;0.893048107624054 0.410338699817657 0;0.889483094215393 0.399049311876297 0;0.885918021202087 0.387759953737259 0;0.882352948188782 0.376470595598221 0],...
    'FontName','Arial','FontSize',24,'FontWeight','bold','Layer','top',...
    'LineWidth',2,'XColor',[0 0 0],'XTick',[1 27],'XTickLabel',{'1','27'},...
    'YColor',[0 0 0],'YTick',[1 49],'YTickLabel',{'1','49'});
set(gca,'box','off'); 
%% correlation
figure('Colormap',...
    [1 1 1;1 1 0.9375;1 1 0.875;1 1 0.8125;1 1 0.75;1 1 0.6875;1 1 0.625;1 1 0.5625;1 1 0.5;1 1 0.4375;1 1 0.375;1 1 0.3125;1 1 0.25;1 1 0.1875;1 1 0.125;1 1 0.0625;1 1 0;1 0.958333333333333 0;1 0.916666666666667 0;1 0.875 0;1 0.833333333333333 0;1 0.791666666666667 0;1 0.75 0;1 0.708333333333333 0;1 0.666666666666667 0;1 0.625 0;1 0.583333333333333 0;1 0.541666666666667 0;1 0.5 0;1 0.458333333333333 0;1 0.416666666666667 0;1 0.375 0;1 0.333333333333333 0;1 0.291666666666667 0;1 0.25 0;1 0.208333333333333 0;1 0.166666666666667 0;1 0.125 0;1 0.0833333333333333 0;1 0.0416666666666667 0;1 0 0;0.958333333333333 0 0;0.916666666666667 0 0;0.875 0 0;0.833333333333333 0 0;0.791666666666667 0 0;0.75 0 0;0.708333333333333 0 0;0.666666666666667 0 0;0.625 0 0;0.583333333333333 0 0;0.541666666666667 0 0;0.5 0 0;0.458333333333333 0 0;0.416666666666667 0 0;0.375 0 0;0.333333333333333 0 0;0.291666666666667 0 0;0.25 0 0;0.208333333333333 0 0;0.166666666666667 0 0;0.125 0 0;0.0833333333333333 0 0;0.0416666666666667 0 0],...
    'Color',[1 1 1],...
    'OuterPosition',[415.4 235.4 574.4 507.2]);
image(cell_cor,'CDataMapping','scaled');

ylabel({'Fear Cell ID'},'FontWeight','bold','FontName','Arial');

xlabel({'Extinction Cell ID'},'FontWeight','bold','FontName','Arial');

set(gca,'CLim',[0 2],'Colormap',...
    [0 0.250980406999588 1;0.0252100843936205 0.341736704111099 0.997198879718781;0.050420168787241 0.43249300122261 0.994397759437561;0.0756302550435066 0.523249328136444 0.991596639156342;0.100840337574482 0.614005625247955 0.988795518875122;0.126050427556038 0.704761922359467 0.985994398593903;0.151260510087013 0.795518219470978 0.983193278312683;0.176470592617989 0.886274516582489 0.980392158031464;0.225882351398468 0.867451012134552 0.869019627571106;0.275294125080109 0.84862744808197 0.757647037506104;0.324705898761749 0.829803943634033 0.646274507045746;0.374117642641068 0.810980379581451 0.534901976585388;0.423529416322708 0.792156875133514 0.423529416322708;0.455555558204651 0.78976035118103 0.400000005960464;0.487581700086594 0.787363827228546 0.376470595598221;0.519607841968536 0.784967303276062 0.352941185235977;0.551634013652802 0.782570838928223 0.329411774873734;0.583660125732422 0.780174314975739 0.30588236451149;0.615686297416687 0.777777791023254 0.282352954149246;0.647712409496307 0.77538126707077 0.258823543787003;0.679738581180573 0.772984743118286 0.235294118523598;0.711764693260193 0.770588278770447 0.211764708161354;0.743790864944458 0.768191754817963 0.18823529779911;0.775816977024078 0.765795230865479 0.164705887436867;0.807843148708344 0.763398706912994 0.141176477074623;0.839869260787964 0.76100218296051 0.117647059261799;0.871895432472229 0.758605659008026 0.0941176488995552;0.903921544551849 0.756209135055542 0.0705882385373116;0.935947716236115 0.753812670707703 0.0470588244497776;0.967973828315735 0.751416146755219 0.0235294122248888;1 0.749019622802734 0;0.996434926986694 0.737730264663696 0;0.992869853973389 0.726440906524658 0;0.989304840564728 0.71515154838562 0;0.985739767551422 0.703862190246582 0;0.982174694538116 0.692572772502899 0;0.978609621524811 0.681283414363861 0;0.975044548511505 0.669994056224823 0;0.971479475498199 0.658704698085785 0;0.967914462089539 0.647415339946747 0;0.964349389076233 0.636125981807709 0;0.960784316062927 0.624836623668671 0;0.957219243049622 0.613547265529633 0;0.953654170036316 0.602257907390594 0;0.950089156627655 0.590968549251556 0;0.946524083614349 0.579679131507874 0;0.942959010601044 0.568389773368835 0;0.939393937587738 0.557100415229797 0;0.935828864574432 0.545811057090759 0;0.932263791561127 0.534521698951721 0;0.928698778152466 0.523232340812683 0;0.92513370513916 0.511942982673645 0;0.921568632125854 0.500653624534607 0;0.918003559112549 0.489364236593246 0;0.914438486099243 0.478074878454208 0;0.910873472690582 0.46678552031517 0;0.907308399677277 0.45549613237381 0;0.903743326663971 0.444206774234772 0;0.900178253650665 0.432917416095734 0;0.89661318063736 0.421628057956696 0;0.893048107624054 0.410338699817657 0;0.889483094215393 0.399049311876297 0;0.885918021202087 0.387759953737259 0;0.882352948188782 0.376470595598221 0],...
    'FontName','Arial','FontSize',24,'FontWeight','bold','Layer','top',...
    'LineWidth',2,'XColor',[0 0 0],'XTick',[1 27],'XTickLabel',{'1','27'},...
    'YColor',[0 0 0],'YTick',[1 49],'YTickLabel',{'1','49'});
set(gca,'box','off'); 

